name: CI

on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Miniconda
      uses: conda-incubator/setup-miniconda@v2
      with:
        auto-update-conda: true
        python-version: 3.11.9  # Specify the Python version you need

    - name: Create environment and install dependencies
      run: |
        conda init bash
        conda config --add channels conda-forge
        source ~/.bashrc
        conda create --name test-env python=3.11.9 -y
        conda activate test-env
        conda install -y requirements.txt
        conda install -y \
          libhdf5-dev \
          cmake \
          gfortran \
          libblas-dev \
          liblapack-dev \
          libeigen3-dev \
          libhdf5-serial-dev \
          autoconf \
          libtool \
          doxygen \
          hdf5-tools \
          progress \
          cyclus \
          cycamore \
          cymetric

    - name: Run tests
      run: |
        source ~/.bashrc
        conda activate test-env
        cd ~/project/scripts/tests/
        pytest